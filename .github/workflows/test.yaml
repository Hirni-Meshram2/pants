# GENERATED, DO NOT EDIT!
# To change, edit `build-support/bin/generate_github_workflows.py` and run:
#   ./pants run build-support/bin/generate_github_workflows.py


env:
  PANTS_CONFIG_FILES: +['pants.ci.toml']
  RUST_BACKTRACE: all
jobs:
  build_wheels_linux:
    name: "Build on ${{ matrix.pyver }} aarch64"
    strategy:
      matrix:
        pyver: [cp36-cp36m, cp38-cp38]
        arch: [aarch64]
    runs-on: ubuntu-latest
    env:
      py: /opt/python/${{ matrix.pyver }}/bin/python
      img: quay.io/pypa/manylinux2014_${{ matrix.arch }}  
      PANTS_REMOTE_CACHE_READ: 'false'
      PANTS_REMOTE_CACHE_WRITE: 'false'
    steps:
    - name: Set up QEMU
      id: qemu
      uses: docker/setup-qemu-action@v1    
    - name: Check out code
      uses: actions/checkout@v2
      with:
        fetch-depth: 10
    - name: Install rustup
      run: |
            docker run --rm -v ${{ github.workspace }}:/ws:rw --workdir=/ws \
            ${{ env.img }} \
            bash -exc '${{ env.py }} -m pip install virtualenv && ${{ env.py }} -m venv .env && \
            source .env/bin/activate && \
            curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -v -y --default-toolchain none && \
            export PATH=$HOME/.cargo/bin:${PATH} && \
            rustup --version && \
            ./build-support/bin/release.sh -q && \
            USE_PY38=true ./build-support/bin/release.sh -q && \
            USE_PY39=true ./build-support/bin/release.sh -q && \
            ./build-support/bin/release.sh -f && \
            deactivate'
    - if: always()
      name: Upload pants.log
      uses: actions/upload-artifact@v2
      with:
        name: pants-log-wheels-linux
        path: .pants.d/pants.log
    - env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      if: github.event_name == 'push'
      name: Deploy to S3
      run: ./build-support/bin/deploy_to_s3.py
    timeout-minutes: 65
name: Pull Request CI
'on':
- push
- pull_request
